@model PTemplate.Models.DataViewModel.MaindadarasViewModel
@namespace PTemplate.Areas.Admin.Data
@using PTemplate.Data.DataBase



@using PTemplate.Data;
@using PTemplate.Data.DataBase;
@using System.Security.Claims;
@using Microsoft.AspNetCore.Mvc;
@using Microsoft.EntityFrameworkCore;



@using PTemplate
@using PTemplate.Models

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers



@{


    ApplicationDbContext appA = new
        ApplicationDbContext(new Microsoft.EntityFrameworkCore.DbContextOptions<ApplicationDbContext>());

    var Ad = appA.Ads
        .Where(b => b.Datestart.Value.Date <= DateTime.Now && b.Datestart.Value.Date <= DateTime.Now && b.Isactive == true)
        .ToList();




}


@{
    ViewData["Title"] = "صفحه نخست";
    Layout = "~/Views/sjtejarat/Shared/_MainHome.cshtml";
    ViewData["homeUrl"] = "";
    ViewData["externalHomeUrl"] = "/sjtejarat/";
}



<div id="carouselExampleIndicators" class="carousel slide mainSlide" data-ride="carousel">

    <ol class="carousel-indicators">
        @{
            bool sl2 = true;
            int is1 = 0;
            if (Model.ListPostTopSlide.Count >= 1)
            {
                foreach (var i in Model.ListPostTopSlide)
                {
                    if (sl2)
                    {
                        <li data-target="#carouselExampleIndicators" data-slide-to="@is1" class="active"></li>
                        is1++;
                        sl2 = false;
                    }
                    else
                    {
                        <li data-target="#carouselExampleIndicators" data-slide-to="@is1" class="active"></li>
                        is1++;
                    }
                }
            }
            else
            {

                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>

            }
        }
        @*<li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>*@
    </ol>
    <div class="carousel-inner">
        @{
            bool sl = true;
            if (Model.ListPostTopSlide.Count >= 1)
            {
                foreach (var i in Model.ListPostTopSlide)
                {
                    if (sl)
                    {
                        <div class="carousel-item active">
                            <ul>
                                <li id="media_image-14" class="widget widget_media_image">
                                    <img width="1560" height="330" src="@i.Pathdata" class="image  attachment-full size-full" alt="@i.Title" loading="lazy" style="max-width: 100%; height: auto;" sizes="(max-width: 1560px) 100vw, 1560px" />
                                </li>
                            </ul>
                        </div>
                        sl = false;
                    }
                    else
                    {
                        <div class="carousel-item">
                            <ul>
                                <li id="media_image-14" class="widget widget_media_image">
                                    <img width="1560" height="330" src="@i.Pathdata" class="image  attachment-full size-full" alt="@i.Title" loading="lazy" style="max-width: 100%; height: auto;" sizes="(max-width: 1560px) 100vw, 1560px" />
                                </li>
                            </ul>
                        </div>
                    }
                }
            }
            else
            {
                <div class="carousel-item active">
                    <ul>
                        <li id="media_image-14" class="widget widget_media_image">
                            <a href="~/sjtejarat/contact">  <img width="1560" height="330" src="~/sjtejarat/images/slider/001.jpg" class="image  attachment-full size-full" alt="" loading="lazy" style="max-width: 100%; height: auto;" sizes="(max-width: 1560px) 100vw, 1560px" /></a>
                        </li>
                    </ul>
                </div>

            }
        }
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="sr-only">Previous</span>
        </a><a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span><span class="sr-only">Next</span>
        </a>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-6 col-md-6 d-flex align-items-stretch">
            <div class="productPopular">
                <header class="productPopular-title">اخرین ارسال ها</header>


                @foreach (var i in Model.ListPost)
                {

                    <article class="homeArticle-new">

                        <figure>
                            <a href="@ViewData["externalHomeUrl"]singlepost/@i.Id"
                               title="@i.Title">
                                <img width="800" height="500"
                                     src="@i.Pathdata"
                                     alt="@i.Title" />
                            </a>
                        </figure>
                        <h4 class="homeArticle-postTitle">
                            <a href="@ViewData["externalHomeUrl"]singlepost/@i.Id"
                               title="@i.Title">@i.Title</a>
                        </h4>
                        <footer class="homeArticle-post-footer">
                            <div class="homeArticle-postFooterItem">
                                @(((DateTime)i.Datestart).ToPersianDigitalDateTimeString())<i class="icon-update"></i>
                            </div>
                            <div class="homeArticle-postFooterItem">
                                <i class="icon-Comment"></i>0
                            </div>
                            <a href="@ViewData["externalHomeUrl"]singlepost/@i.Id"
                               title="@i.Title"
                               class="homeArticle-postMore">
                                <i class="icon-arrow-left-circle"></i>
                            </a>
                        </footer>

                    </article>


                }
                <br />
                @if (Model.ListPost != null)
                {
                    if (Model.ListPost.Count >= 1)
                    {


                        <!-- Pagination -->
                        <nav>
                            <ul class="pagination rtl">
                                <li class="page-item "><a class="page-link" href="@ViewData["externalHomeUrl"]sjtejarat?Idmenu=@ViewData["idmenu"]&paging=1">ابتدا</a></li>
                                @for (var p = 1; p <= (int)ViewData["PostRe"]; p++)
                                {
                                    if ((int)ViewData["paging"] == p)
                                    {
                                        <li class="page-item active"><a class="page-link" href="@ViewData["externalHomeUrl"]sjtejarat?Idmenu=@ViewData["idmenu"]&paging=@p">@p</a></li>
                                    }
                                    else
                                    {
                                        <li class="page-item"><a class="page-link" href="@ViewData["externalHomeUrl"]sjtejarat?Idmenu=@ViewData["idmenu"]&paging=@p">@p</a></li>
                                    }
                                }
                                <li class="page-item ">
                                    <a class="page-link" href="@ViewData["externalHomeUrl"]sjtejarat?Idmenu=@ViewData["idmenu"]&paging=@ViewData["PostRe"]">انتها</a>
                                </li>

                            </ul>
                        </nav>
                    }
                    else
                    {
                        <span class="text-xlarge center-block"> موردی یافت نشد </span>
                    }
                }
                <br />
            </div>
        </div>
        <div class="col-lg-6 col-md-6 d-flex align-items-stretch">
            <div class="productPopular">
                <header class="productPopular-title">نرخ دلار</header>
                <!-- start slider product -->

                <div id="tgju-data"></div>
                <script>var tgju_params = {
    type: "simple",
    items: ["price_dollar_rl", "price_eur", "price_aed", "price_gbp", "price_sek"], columns: ["diff", "low", "high", "time"],
                        placeholder: "tgju-data", token: "webservice"
                    };</script>
                @*<script src="https://api.accessban.com/v1/widget"></script>*@
               
            <div id="scmoney">

            

            </div>
                <style></style>

                <!-- end slider product-->
            </div>
        </div>
        <div class="col-lg-3 col-md-3 d-flex align-items-stretch">
            <div class="productPopular">
                @{
                    foreach (var i in Ad)
                    {
                        <a href="@(i.Link)" class="add-img">
                            <img src="@(i.Path)" alt="" style="margin-bottom:5px;">
                        </a>

                    }

                }
            </div>
        </div>
        <div class="col-lg-3 col-md-3 d-flex align-items-stretch">
            <div class="productPopular">


            </div>
        </div>
    </div>
</div>




@section Scripts
{


    <script>
        var ij = 0;
        
        document.addEventListener("DOMContentLoaded", function () {
            setInterval(function () { startaddmap(); }, 1000);
   
           
        });


        function startaddmap() {






            $.ajax({
                type: 'GET',
                url: "https://api.accessban.com/v1/widget",

                success: function (result) {

                    var res = result.split(";", 1);
                    var myObj = res[0].substr(15, res[0].length);

                    const tgju_data = JSON.parse(myObj);

                   
                    //var h = document.getElementById("scmoney");
                    //h.insertAdjacentHTML("afterbegin", "<p id=A" + (ij) + ">" + obj.price_eur.title + " : " + obj.price_eur.p + " تاریخ->" + obj.price_eur.t+"</p>");
                    //if (ij>=3) {
                    //    var rem = document.getElementById("A" + (ij-3));
                    //    rem.remove();
                    //}
                    //ij++;


                    if (tgju_data) {
                        var key, this_item, td;
                        var rows = '';

                        for (index in tgju_params.items) {
                            key = tgju_params.items[index];

                            this_item = tgju_data[key];
                            if (this_item === undefined) continue;

                            td = {
                                'diff': tgju_params.columns.indexOf("diff") >= 0 ? '<td class="nf">' + '<span class="' + this_item['dt'] + '">(' + this_item['dp'] + '%) ' + this_item['d'] + '</span>' + '</td>' : '',
                                'low': tgju_params.columns.indexOf("low") >= 0 ? '<td class="nf">' + this_item['l'] + '</td>' : '',
                                'high': tgju_params.columns.indexOf("high") >= 0 ? '<td class="nf">' + this_item['h'] + '</td>' : '',
                                'time': tgju_params.columns.indexOf("time") >= 0 ? '<td class="nf">' + this_item['t'] + '</td>' : ''
                            };

                            rows += '<tr id="f-' + key + '"><th>' + this_item['title'] + '</th><td class="nf">' + this_item['p'] + '</td>' + td.diff + td.low + td.high + td.time + '</tr>';
                        }

                        var th = {
                            'diff': tgju_params.columns.indexOf("diff") >= 0 ? '<th>تغییر</th>' : '',
                            'low': tgju_params.columns.indexOf("low") >= 0 ? '<th>کمترین</th>' : '',
                            'high': tgju_params.columns.indexOf("high") >= 0 ? '<th>بیشترین</th>' : '',
                            'time': tgju_params.columns.indexOf("time") >= 0 ? '<th>زمان</th>' : ''
                        };

                        var copyright = '';
                        var embed_style = '';
                        if (tgju_params.token === 'webservice') {
                            copyright = '<a href="#" target="_blank" class="tgju-copyright">WWW.sjtejarat.ir</a>';
                            embed_style = '#tgju-data-block #tgju table.data-table thead { 	display: none; }  #tgju-data-block #tgju table.data-table tbody tr { 	display: block !important; }  #tgju-data-block #tgju table.data-table tbody th { 	border-bottom: none !important; 	display: block !important; 	text-align: center !important; 	padding: 3px 10px 3px !important; 	background-color: #F1F1F1; }  #tgju-data-block #tgju table.data-table tbody td { 	display: block !important; 	text-align: center !important; 	width: 128px !important; 	padding: 3px 10px 5px !important; }  #tgju-data-title { 	text-align: center; 	color: #fff; 	font-family: tahoma; 	font-size: 12px; 	font-weight: bold; 	direction: rtl;  	background: #1A1A1A;     padding: 5px 5px 7px; }  .tgju-copyright { 	display: block; 	text-align: center; 	color: #eee !important; 	text-decoration: none; 	font-family: tahoma; 	font-size: 11px; 	margin-top: -15px; 	margin-bottom: 10px; 	direction: rtl;  	background: #1A1A1A;     padding: 4px 1px 6px;     margin-top: -20px; }  .tgju-copyright:hover, .tgju-copyright:focus{color:#eee !important}  .tgju-section-title { 	font: bold 12px/1 tahoma; 	text-align: center; 	background-color: #404042; 	padding: 7px 7px 8px; 	color: #FFF; }  #tgju table.data-table { 	padding: 0 !important; 	border-top: 0 !important; 	border-color: #1A1A1A !important; }  #tgju table.data-table tbody tr th, #tgju table.data-table tbody tr td { 	border-bottom: 1px solid #DCDCDC !important; }  body #tgju table.data-table tbody tr:hover { 	background: #DEDEDE !important; }  #tgju table.data-table thead th {     background: #1a1a1a;     color: #FFF;     text-shadow: none; }';
                        }

                        document.getElementById("scmoney").innerHTML = '<style>#tgju table.data-table {width:100%;border-spacing:0;padding:1px;font:normal 11px tahoma;direction: rtl;}#tgju table.data-table {border:1px solid #e5e5e5;margin-bottom:20px;}table thead th{border-bottom:1px solid #e9e9e9;padding:6px 10px 9px;text-shadow:0 1px 1px #fff;background:#F7F7F7;text-align:right!important;}table tr td{padding:7px 0 10px;border-bottom:1px solid #efefef;}table tr:last-child td{border-bottom:0;}#tgju table.data-table tbody tr th{padding:6px 10px 8px;background-color:#fff;border-bottom:1px solid #efefef;text-align:right!important;}#tgju table.data-table tbody tr th.tophead{background:#fff;}#tgju table.data-table tbody tr td{padding:6px 10px 8px;vertical-align:top;text-align:right;}#tgju table.data-table tbody tr:hover{background:#f1fdff!important;-webkit-transition:none;-moz-transition:none;-o-transition:none;-ms-transition:none;transition:none;}#tgju table.data-table tbody tr:hover th{-webkit-transition:none;-moz-transition:none;-o-transition:none;-ms-transition:none;transition:none;background-color:transparent!important;}#tgju table.data-table tbody tr:hover th.tophead{background:#fff!important;}#tgju table.data-table tbody tr:last-child td,#tgju table.data-table tbody tr:last-child th{border-bottom:none;}#tgju table.data-table.data-table-child{border:none!important;float:right;width:49%;-webkit-box-shadow:none!important;box-shadow:none!important;margin-bottom:0!important;}#tgju table.data-table.data-table-child-side{float:left;}#tgju .nf.high,#tgju .nf .high{color:#39bb88!important;}#tgju .nf.low,#tgju .nf .low{color:#ea2e2e!important;}' + embed_style + '</style><div id="tgju"><table class="data-table"><thead><tr><th>عنوان نرخ</th><th>قیمت زنده</th>' + th.diff + th.low + th.high + th.time + '</tr></thead><tbody>' + rows + '</tbody></table>' + copyright + '</div>';
                    }



                }
                , error: function (xhr, status, error) {
                    alert('دوباره تلاش کنید');

                }
            });

        }

    </script>
}